<!doctype html>
<html lang="en">
<head>
<style>.homelink{display:block;font-size:2em;font-weight:bold;color:#555;padding-bottom:.5em;border-bottom:1px solid silver}.homelink:hover{color:inherit}.homelink img{max-width:20%;max-height:5em;margin:auto;margin-bottom:.3em}</style>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<link rel="icon" href="https://raw.githubusercontent.com/OpShin/opshin/dev/docs/opshin_32.png" sizes="32x32" type="image/png">
<title>opshin.builder API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}#lunr-search{width:100%;font-size:1em;padding:6px 9px 5px 9px;border:1px solid silver}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<style>
.github-corner:hover .octo-arm {
animation: octocat-wave 560ms ease-in-out
}
@keyframes octocat-wave {
0%,
100% {
transform: rotate(0)
}
20%,
60% {
transform: rotate(-25deg)
}
40%,
80% {
transform: rotate(10deg)
}
}
@media (max-width:500px) {
.github-corner:hover .octo-arm {
animation: none
}
.github-corner .octo-arm {
animation: octocat-wave 560ms ease-in-out
}
}
</style>
<a href="https://github.com/opshin/opshin" class="github-corner" aria-label="View source on GitHub">
<svg width="80" height="80" viewBox="0 0 250 250"
style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
<path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z">
</path>
<path
d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
<path
d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
fill="currentColor" class="octo-body"></path>
</svg>
</a>
<article id="content">
<header>
<h1 class="title">Module <code>opshin.builder</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">import copy
import dataclasses
import enum
import functools
import json
import types
import typing
from ast import Module
from typing import Optional, Any, Union
from pathlib import Path

from pycardano import PlutusV2Script, IndefiniteList, PlutusData, Datum

from . import __version__, compiler

import uplc.ast
from uplc import flatten, ast as uplc_ast, eval as uplc_eval
import cbor2
import pycardano
from pluthon import compile as plt_compile

from .util import datum_to_cbor


class Purpose(enum.Enum):
    spending = &#34;spending&#34;
    minting = &#34;minting&#34;
    rewarding = &#34;rewarding&#34;
    certifying = &#34;certifying&#34;
    any = &#34;any&#34;
    lib = &#34;lib&#34;


@dataclasses.dataclass
class PlutusContract:
    contract: PlutusV2Script
    datum_type: Optional[typing.Tuple[str, typing.Type[Datum]]] = None
    redeemer_type: Optional[typing.Tuple[str, typing.Type[Datum]]] = None
    parameter_types: typing.List[typing.Tuple[str, typing.Type[Datum]]] = (
        dataclasses.field(default_factory=list)
    )
    purpose: typing.Iterable[Purpose] = (Purpose.any,)
    version: Optional[str] = &#34;1.0.0&#34;
    title: str = &#34;validator&#34;
    description: Optional[str] = f&#34;opshin {__version__} Smart Contract&#34;
    license: Optional[str] = None

    @property
    def cbor(self) -&gt; bytes:
        return self.contract

    @property
    def cbor_hex(self) -&gt; str:
        return self.contract.hex()

    @property
    def script_hash(self):
        return pycardano.plutus_script_hash(self.contract)

    @property
    def policy_id(self):
        return self.script_hash.to_primitive().hex()

    @property
    def mainnet_addr(self):
        return pycardano.Address(self.script_hash, network=pycardano.Network.MAINNET)

    @property
    def testnet_addr(self):
        return pycardano.Address(self.script_hash, network=pycardano.Network.TESTNET)

    @property
    def plutus_json(self):
        return json.dumps(
            {
                &#34;type&#34;: &#34;PlutusScriptV2&#34;,
                &#34;description&#34;: self.description,
                &#34;cborHex&#34;: self.cbor_hex,
            },
            indent=2,
        )

    @property
    def blueprint(self):
        return {
            &#34;$schema&#34;: &#34;https://cips.cardano.org/cips/cip57/schemas/plutus-blueprint.json&#34;,
            &#34;$id&#34;: &#34;https://github.com/aiken-lang/aiken/blob/main/examples/hello_world/plutus.json&#34;,
            &#34;$vocabulary&#34;: {
                &#34;https://json-schema.org/draft/2020-12/vocab/core&#34;: True,
                &#34;https://json-schema.org/draft/2020-12/vocab/applicator&#34;: True,
                &#34;https://json-schema.org/draft/2020-12/vocab/validation&#34;: True,
                &#34;https://cips.cardano.org/cips/cip57&#34;: True,
            },
            &#34;preamble&#34;: {
                &#34;version&#34;: self.version,
                &#34;plutusVersion&#34;: &#34;v2&#34;,
                &#34;description&#34;: self.description,
                &#34;title&#34;: self.title,
                **({&#34;license&#34;: self.license} if self.license is not None else {}),
            },
            &#34;validators&#34;: [
                {
                    &#34;title&#34;: self.title,
                    **(
                        {
                            &#34;datum&#34;: {
                                &#34;title&#34;: self.datum_type[0],
                                &#34;purpose&#34;: PURPOSE_MAP[Purpose.spending],
                                &#34;schema&#34;: to_plutus_schema(self.datum_type[1]),
                            }
                        }
                        if self.datum_type is not None
                        else {}
                    ),
                    &#34;redeemer&#34;: (
                        {
                            &#34;title&#34;: self.redeemer_type[0],
                            &#34;purpose&#34;: {
                                &#34;oneOf&#34;: [PURPOSE_MAP[p] for p in self.purpose]
                            },
                            &#34;schema&#34;: to_plutus_schema(self.redeemer_type[1]),
                        }
                        if self.redeemer_type is not None
                        else {}
                    ),
                    **(
                        {
                            &#34;parameters&#34;: [
                                {
                                    &#34;title&#34;: t[0],
                                    &#34;purpose&#34;: PURPOSE_MAP[Purpose.spending],
                                    &#34;schema&#34;: to_plutus_schema(t[1]),
                                }
                                for t in self.parameter_types
                            ]
                        }
                        if self.parameter_types
                        else {}
                    ),
                    &#34;compiledCode&#34;: self.cbor_hex,
                    &#34;hash&#34;: self.policy_id,
                },
            ],
        }

    def apply_parameter(self, *args: pycardano.Datum):
        &#34;&#34;&#34;
        Returns a new OpShin Contract with the applied parameters
        &#34;&#34;&#34;
        # update the parameters in the blueprint (remove applied parameters)
        assert len(self.parameter_types) &gt;= len(
            args
        ), f&#34;Applying too many parameters to contract, allowed amount: {self.parameter_types}, but got {len(args)}&#34;
        new_parameter_types = copy.copy(self.parameter_types)
        for _ in args:
            # TODO validate that the applied parameters are of the correct type
            new_parameter_types.pop(0)
        new_contract_contract = apply_parameters(self.contract, *args)
        new_contract = PlutusContract(
            new_contract_contract,
            self.datum_type,
            self.redeemer_type,
            new_parameter_types,
            self.purpose,
            self.version,
            self.title,
            self.description,
        )
        return new_contract

    def dump(self, target_dir: Union[str, Path]):
        target_dir = Path(target_dir)
        target_dir.mkdir(exist_ok=True, parents=True)
        with (target_dir / &#34;script.cbor&#34;).open(&#34;w&#34;) as fp:
            fp.write(self.cbor_hex)
        with (target_dir / &#34;script.plutus&#34;).open(&#34;w&#34;) as fp:
            fp.write(self.plutus_json)
        with (target_dir / &#34;script.policy_id&#34;).open(&#34;w&#34;) as fp:
            fp.write(self.policy_id)
        with (target_dir / &#34;mainnet.addr&#34;).open(&#34;w&#34;) as fp:
            fp.write(self.mainnet_addr.encode())
        with (target_dir / &#34;testnet.addr&#34;).open(&#34;w&#34;) as fp:
            fp.write(self.testnet_addr.encode())
        with (target_dir / &#34;blueprint.json&#34;).open(&#34;w&#34;) as fp:
            json.dump(self.blueprint, fp, indent=2)


def compile(
    program: Module,
    contract_filename: Optional[str] = None,
    force_three_params=False,
    validator_function_name=&#34;validator&#34;,
    remove_dead_code=True,
    constant_folding=False,
    allow_isinstance_anything=False,
    **pluto_kwargs: Any,
) -&gt; uplc_ast.Program:
    code = compiler.compile(
        program,
        filename=contract_filename,
        force_three_params=force_three_params,
        validator_function_name=validator_function_name,
        remove_dead_code=remove_dead_code,
        constant_folding=constant_folding,
        allow_isinstance_anything=allow_isinstance_anything,
    )
    plt_code = plt_compile(code, **pluto_kwargs)
    return plt_code


@functools.lru_cache(maxsize=32)
def _static_compile(
    source_code: str,
    contract_file: str = &#34;&lt;unknown&gt;&#34;,
    force_three_params=False,
    validator_function_name=&#34;validator&#34;,
    optimize_patterns=True,
    remove_dead_code=True,
    constant_folding=False,
    allow_isinstance_anything=False,
):
    &#34;&#34;&#34;
    Expects a python module and returns the build artifacts from compiling it
    &#34;&#34;&#34;

    source_ast = compiler.parse(source_code, filename=contract_file)
    code = compile(
        source_ast,
        contract_filename=contract_file,
        force_three_params=force_three_params,
        validator_function_name=validator_function_name,
        optimize_patterns=optimize_patterns,
        remove_dead_code=remove_dead_code,
        constant_folding=constant_folding,
        allow_isinstance_anything=allow_isinstance_anything,
    )
    return code


def _compile(
    source_code: str,
    *args: typing.Union[pycardano.Datum, uplc_ast.Constant],
    contract_file: str = &#34;&lt;unknown&gt;&#34;,
    force_three_params=False,
    validator_function_name=&#34;validator&#34;,
    optimize_patterns=True,
    remove_dead_code=True,
    constant_folding=False,
    allow_isinstance_anything=False,
):
    &#34;&#34;&#34;
    Expects a python module and returns the build artifacts from compiling it
    &#34;&#34;&#34;

    code = _static_compile(
        source_code,
        contract_file=contract_file,
        force_three_params=force_three_params,
        validator_function_name=validator_function_name,
        optimize_patterns=optimize_patterns,
        remove_dead_code=remove_dead_code,
        constant_folding=constant_folding,
        allow_isinstance_anything=allow_isinstance_anything,
    )
    code = _apply_parameters(code, *args)
    return code


def build(
    contract_file: str,
    *args: typing.Union[pycardano.Datum, uplc_ast.Constant],
    force_three_params=False,
    validator_function_name=&#34;validator&#34;,
    optimize_patterns=True,
):
    &#34;&#34;&#34;
    Expects a python module and returns the build artifacts from compiling it
    &#34;&#34;&#34;
    with open(contract_file) as f:
        source_code = f.read()
    code = _compile(
        source_code,
        *args,
        contract_file=contract_file,
        force_three_params=force_three_params,
        validator_function_name=validator_function_name,
        optimize_patterns=optimize_patterns,
    )
    return _build(code)


def _build(contract: uplc.ast.Program):
    # create cbor file for use with pycardano/lucid
    cbor = flatten(contract)
    return pycardano.PlutusV2Script(cbor)


PURPOSE_MAP = {
    Purpose.any: {&#34;oneOf&#34;: [&#34;spend&#34;, &#34;mint&#34;, &#34;withdraw&#34;, &#34;publish&#34;]},
    Purpose.spending: &#34;spend&#34;,
    Purpose.minting: &#34;mint&#34;,
    Purpose.rewarding: &#34;withdraw&#34;,
    Purpose.certifying: &#34;publish&#34;,
}


def to_plutus_schema(cls: typing.Type[Datum]) -&gt; dict:
    &#34;&#34;&#34;
    Convert to a dictionary representing a json schema according to CIP 57 Plutus Blueprint
    Reference of the core structure:
    https://cips.cardano.org/cips/cip57/#corevocabulary

    Args:
        **kwargs: Extra key word arguments to be passed to `json.dumps()`

    Returns:
        dict: a dict representing the schema of this class.
    &#34;&#34;&#34;
    if hasattr(cls, &#34;__origin__&#34;) and cls.__origin__ is list:
        return {
            &#34;dataType&#34;: &#34;list&#34;,
            **(
                {&#34;items&#34;: to_plutus_schema(cls.__args__[0])}
                if hasattr(cls, &#34;__args__&#34;)
                else {}
            ),
        }
    elif hasattr(cls, &#34;__origin__&#34;) and cls.__origin__ is dict:
        return {
            &#34;dataType&#34;: &#34;map&#34;,
            **(
                {
                    &#34;keys&#34;: to_plutus_schema(cls.__args__[0]),
                    &#34;values&#34;: to_plutus_schema(cls.__args__[1]),
                }
                if hasattr(cls, &#34;__args__&#34;)
                else {}
            ),
        }
    elif hasattr(cls, &#34;__origin__&#34;) and cls.__origin__ is Union:
        return {
            &#34;anyOf&#34;: (
                [to_plutus_schema(t) for t in cls.__args__]
                if hasattr(cls, &#34;__args__&#34;)
                else []
            )
        }
    elif issubclass(cls, PlutusData):
        fields = []
        for field_value in cls.__dataclass_fields__.values():
            if field_value.name == &#34;CONSTR_ID&#34;:
                continue
            field_schema = to_plutus_schema(field_value.type)
            field_schema[&#34;title&#34;] = field_value.name
            fields.append(field_schema)
        return {
            &#34;dataType&#34;: &#34;constructor&#34;,
            &#34;index&#34;: cls.CONSTR_ID,
            &#34;fields&#34;: fields,
            &#34;title&#34;: cls.__name__,
        }
    elif issubclass(cls, bytes):
        return {&#34;dataType&#34;: &#34;bytes&#34;}
    elif issubclass(cls, int):
        return {&#34;dataType&#34;: &#34;integer&#34;}
    elif issubclass(cls, IndefiniteList) or issubclass(cls, list):
        return {&#34;dataType&#34;: &#34;list&#34;}
    else:
        return {}


def from_plutus_schema(schema: dict) -&gt; typing.Type[pycardano.Datum]:
    &#34;&#34;&#34;
    Convert from a dictionary representing a json schema according to CIP 57 Plutus Blueprint
    &#34;&#34;&#34;
    if schema == {}:
        return pycardano.Datum
    if &#34;anyOf&#34; in schema:
        if len(schema[&#34;anyOf&#34;]) == 0:
            raise ValueError(&#34;Cannot convert empty anyOf schema&#34;)
        union_t = typing.Union[from_plutus_schema(schema[&#34;anyOf&#34;][0])]
        for s in schema[&#34;anyOf&#34;][1:]:
            union_t = typing.Union[union_t, from_plutus_schema(s)]
        return union_t
    if &#34;dataType&#34; in schema:
        typ = schema[&#34;dataType&#34;]
        if typ == &#34;bytes&#34;:
            return bytes
        elif typ == &#34;integer&#34;:
            return int
        elif typ == &#34;list&#34;:
            if &#34;items&#34; in schema:
                return typing.List[from_plutus_schema(schema[&#34;items&#34;])]
            else:
                return typing.List[pycardano.Datum]
        elif typ == &#34;map&#34;:
            key_t = (
                from_plutus_schema(schema[&#34;keys&#34;])
                if &#34;keys&#34; in schema
                else pycardano.Datum
            )
            value_t = (
                from_plutus_schema(schema[&#34;values&#34;])
                if &#34;values&#34; in schema
                else pycardano.Datum
            )
            return typing.Dict[key_t, value_t]
        elif typ == &#34;constructor&#34;:
            fields = {}
            for field in schema[&#34;fields&#34;]:
                fields[field[&#34;title&#34;]] = from_plutus_schema(field)
            fields[&#34;CONSTR_ID&#34;] = schema[&#34;index&#34;]
            return dataclasses.dataclass(
                type(schema[&#34;title&#34;], (pycardano.PlutusData,), fields)
            )
    raise ValueError(f&#34;Cannot read schema (not supported yet) {schema}&#34;)


def apply_parameters(script: PlutusV2Script, *args: pycardano.Datum):
    &#34;&#34;&#34;
    Expects a plutus script (compiled) and returns the compiled script from applying parameters to it
    &#34;&#34;&#34;
    return _build(_apply_parameters(uplc.unflatten(script), *args))


def _apply_parameters(script: uplc.ast.Program, *args: pycardano.Datum):
    &#34;&#34;&#34;
    Expects a UPLC program and returns the build artifacts from applying parameters to it
    &#34;&#34;&#34;
    # apply parameters from the command line to the contract (instantiates parameterized contract!)
    code = script.term
    # UPLC lambdas may only take one argument at a time, so we evaluate by repeatedly applying
    for d in args:
        code = uplc.ast.Apply(
            code,
            (
                uplc.ast.data_from_cbor(datum_to_cbor(d))
                if not isinstance(d, uplc_ast.Constant)
                else d
            ),
        )
    code = uplc.ast.Program((1, 0, 0), code)
    return code


def load(contract_path: Union[Path, str]) -&gt; PlutusContract:
    &#34;&#34;&#34;
    Load a contract from a file or directory and generate the artifacts
    &#34;&#34;&#34;
    if isinstance(contract_path, str):
        contract_path = Path(contract_path)
    if contract_path.is_dir():
        contract_candidates = list(contract_path.iterdir())
    elif contract_path.is_file():
        contract_candidates = [contract_path]
    else:
        raise ValueError(
            f&#34;Invalid contract path, is neither file nor directory: {contract_path}&#34;
        )
    for contract_file in contract_candidates:
        with contract_file.open(&#34;r&#34;) as f:
            contract_content = f.read()
        # could be a plutus blueprint
        try:
            contract = json.loads(contract_content)
            if &#34;validators&#34; in contract:
                assert len(contract[&#34;validators&#34;]) == 1, &#34;Only one validator supported&#34;
                validator = contract[&#34;validators&#34;][0]
                contract_cbor = PlutusV2Script(bytes.fromhex(validator[&#34;compiledCode&#34;]))
                datum_type = (
                    validator[&#34;datum&#34;][&#34;title&#34;],
                    from_plutus_schema(validator[&#34;datum&#34;][&#34;schema&#34;]),
                )
                redeemer_type = (
                    validator[&#34;redeemer&#34;][&#34;title&#34;],
                    from_plutus_schema(validator[&#34;redeemer&#34;][&#34;schema&#34;]),
                )
                parameter_types = [
                    (p[&#34;title&#34;], from_plutus_schema(p[&#34;schema&#34;]))
                    for p in validator[&#34;parameters&#34;]
                ]
                if &#34;oneOf&#34; in validator[&#34;redeemer&#34;][&#34;purpose&#34;]:
                    purpose = [
                        k
                        for k, v in PURPOSE_MAP.items()
                        if v in validator[&#34;redeemer&#34;][&#34;purpose&#34;][&#34;oneOf&#34;]
                    ]
                else:
                    purpose = [
                        k
                        for k, v in PURPOSE_MAP.items()
                        if v == validator[&#34;redeemer&#34;][&#34;purpose&#34;]
                    ]
                version = contract[&#34;preamble&#34;].get(&#34;version&#34;)
                title = contract[&#34;preamble&#34;].get(&#34;title&#34;)
                description = contract[&#34;preamble&#34;].get(&#34;description&#34;)
                license = contract[&#34;preamble&#34;].get(&#34;license&#34;)
                assert (
                    contract[&#34;preamble&#34;].get(&#34;plutusVersion&#34;) == &#34;v2&#34;
                ), &#34;Only Plutus V2 supported&#34;
                return PlutusContract(
                    contract_cbor,
                    datum_type,
                    redeemer_type,
                    parameter_types,
                    purpose,
                    version,
                    title,
                    description,
                    license,
                )
        except (ValueError, KeyError) as e:
            pass
    contract_cbor = None
    for contract_file in contract_candidates:
        with contract_file.open(&#34;r&#34;) as f:
            contract_content = f.read()
        # could be a singly wrapped cbor hex
        try:
            # try to unwrap to see if it is cbor
            contract_cbor_unwrapped = cbor2.loads(bytes.fromhex(contract_content))
            contract_cbor = bytes.fromhex(contract_content)
            # if we can unwrap again, its doubly wrapped
            try:
                cbor2.loads(contract_cbor_unwrapped)
                contract_cbor = contract_cbor_unwrapped
            except ValueError:
                pass
            break
        except ValueError:
            pass
        # could be a plutus json
        try:
            contract = json.loads(contract_content)
            contract_cbor = cbor2.loads(bytes.fromhex(contract[&#34;cborHex&#34;]))
        except (ValueError, KeyError):
            pass
        # could be uplc
        try:
            contract_ast = uplc.parse(contract_content)
            contract_cbor = uplc.flatten(contract_ast)
        except:
            pass
    if contract_cbor is None:
        raise ValueError(f&#34;Could not load contract from file {contract_path}&#34;)
    return PlutusContract(PlutusV2Script(contract_cbor))</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="opshin.builder.apply_parameters"><code class="name flex">
<span>def <span class="ident">apply_parameters</span></span>(<span>script: pycardano.plutus.PlutusV2Script, *args: Union[pycardano.plutus.PlutusData, dict, int, bytes, pycardano.serialization.IndefiniteList, pycardano.serialization.RawCBOR, pycardano.plutus.RawPlutusData])</span>
</code></dt>
<dd>
<div class="desc"><p>Expects a plutus script (compiled) and returns the compiled script from applying parameters to it</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def apply_parameters(script: PlutusV2Script, *args: pycardano.Datum):
    &#34;&#34;&#34;
    Expects a plutus script (compiled) and returns the compiled script from applying parameters to it
    &#34;&#34;&#34;
    return _build(_apply_parameters(uplc.unflatten(script), *args))</code></pre>
</details>
</dd>
<dt id="opshin.builder.build"><code class="name flex">
<span>def <span class="ident">build</span></span>(<span>contract_file: str, *args: Union[pycardano.plutus.PlutusData, dict, int, bytes, pycardano.serialization.IndefiniteList, pycardano.serialization.RawCBOR, pycardano.plutus.RawPlutusData, uplc.ast.Constant], force_three_params=False, validator_function_name='validator', optimize_patterns=True)</span>
</code></dt>
<dd>
<div class="desc"><p>Expects a python module and returns the build artifacts from compiling it</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def build(
    contract_file: str,
    *args: typing.Union[pycardano.Datum, uplc_ast.Constant],
    force_three_params=False,
    validator_function_name=&#34;validator&#34;,
    optimize_patterns=True,
):
    &#34;&#34;&#34;
    Expects a python module and returns the build artifacts from compiling it
    &#34;&#34;&#34;
    with open(contract_file) as f:
        source_code = f.read()
    code = _compile(
        source_code,
        *args,
        contract_file=contract_file,
        force_three_params=force_three_params,
        validator_function_name=validator_function_name,
        optimize_patterns=optimize_patterns,
    )
    return _build(code)</code></pre>
</details>
</dd>
<dt id="opshin.builder.compile"><code class="name flex">
<span>def <span class="ident">compile</span></span>(<span>program: ast.Module, contract_filename: Optional[str] = None, force_three_params=False, validator_function_name='validator', remove_dead_code=True, constant_folding=False, allow_isinstance_anything=False, **pluto_kwargs: Any) ‑> uplc.ast.Program</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def compile(
    program: Module,
    contract_filename: Optional[str] = None,
    force_three_params=False,
    validator_function_name=&#34;validator&#34;,
    remove_dead_code=True,
    constant_folding=False,
    allow_isinstance_anything=False,
    **pluto_kwargs: Any,
) -&gt; uplc_ast.Program:
    code = compiler.compile(
        program,
        filename=contract_filename,
        force_three_params=force_three_params,
        validator_function_name=validator_function_name,
        remove_dead_code=remove_dead_code,
        constant_folding=constant_folding,
        allow_isinstance_anything=allow_isinstance_anything,
    )
    plt_code = plt_compile(code, **pluto_kwargs)
    return plt_code</code></pre>
</details>
</dd>
<dt id="opshin.builder.from_plutus_schema"><code class="name flex">
<span>def <span class="ident">from_plutus_schema</span></span>(<span>schema: dict) ‑> Type[Union[pycardano.plutus.PlutusData, dict, int, bytes, pycardano.serialization.IndefiniteList, pycardano.serialization.RawCBOR, pycardano.plutus.RawPlutusData]]</span>
</code></dt>
<dd>
<div class="desc"><p>Convert from a dictionary representing a json schema according to CIP 57 Plutus Blueprint</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def from_plutus_schema(schema: dict) -&gt; typing.Type[pycardano.Datum]:
    &#34;&#34;&#34;
    Convert from a dictionary representing a json schema according to CIP 57 Plutus Blueprint
    &#34;&#34;&#34;
    if schema == {}:
        return pycardano.Datum
    if &#34;anyOf&#34; in schema:
        if len(schema[&#34;anyOf&#34;]) == 0:
            raise ValueError(&#34;Cannot convert empty anyOf schema&#34;)
        union_t = typing.Union[from_plutus_schema(schema[&#34;anyOf&#34;][0])]
        for s in schema[&#34;anyOf&#34;][1:]:
            union_t = typing.Union[union_t, from_plutus_schema(s)]
        return union_t
    if &#34;dataType&#34; in schema:
        typ = schema[&#34;dataType&#34;]
        if typ == &#34;bytes&#34;:
            return bytes
        elif typ == &#34;integer&#34;:
            return int
        elif typ == &#34;list&#34;:
            if &#34;items&#34; in schema:
                return typing.List[from_plutus_schema(schema[&#34;items&#34;])]
            else:
                return typing.List[pycardano.Datum]
        elif typ == &#34;map&#34;:
            key_t = (
                from_plutus_schema(schema[&#34;keys&#34;])
                if &#34;keys&#34; in schema
                else pycardano.Datum
            )
            value_t = (
                from_plutus_schema(schema[&#34;values&#34;])
                if &#34;values&#34; in schema
                else pycardano.Datum
            )
            return typing.Dict[key_t, value_t]
        elif typ == &#34;constructor&#34;:
            fields = {}
            for field in schema[&#34;fields&#34;]:
                fields[field[&#34;title&#34;]] = from_plutus_schema(field)
            fields[&#34;CONSTR_ID&#34;] = schema[&#34;index&#34;]
            return dataclasses.dataclass(
                type(schema[&#34;title&#34;], (pycardano.PlutusData,), fields)
            )
    raise ValueError(f&#34;Cannot read schema (not supported yet) {schema}&#34;)</code></pre>
</details>
</dd>
<dt id="opshin.builder.load"><code class="name flex">
<span>def <span class="ident">load</span></span>(<span>contract_path: Union[pathlib.Path, str]) ‑> <a title="opshin.builder.PlutusContract" href="#opshin.builder.PlutusContract">PlutusContract</a></span>
</code></dt>
<dd>
<div class="desc"><p>Load a contract from a file or directory and generate the artifacts</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def load(contract_path: Union[Path, str]) -&gt; PlutusContract:
    &#34;&#34;&#34;
    Load a contract from a file or directory and generate the artifacts
    &#34;&#34;&#34;
    if isinstance(contract_path, str):
        contract_path = Path(contract_path)
    if contract_path.is_dir():
        contract_candidates = list(contract_path.iterdir())
    elif contract_path.is_file():
        contract_candidates = [contract_path]
    else:
        raise ValueError(
            f&#34;Invalid contract path, is neither file nor directory: {contract_path}&#34;
        )
    for contract_file in contract_candidates:
        with contract_file.open(&#34;r&#34;) as f:
            contract_content = f.read()
        # could be a plutus blueprint
        try:
            contract = json.loads(contract_content)
            if &#34;validators&#34; in contract:
                assert len(contract[&#34;validators&#34;]) == 1, &#34;Only one validator supported&#34;
                validator = contract[&#34;validators&#34;][0]
                contract_cbor = PlutusV2Script(bytes.fromhex(validator[&#34;compiledCode&#34;]))
                datum_type = (
                    validator[&#34;datum&#34;][&#34;title&#34;],
                    from_plutus_schema(validator[&#34;datum&#34;][&#34;schema&#34;]),
                )
                redeemer_type = (
                    validator[&#34;redeemer&#34;][&#34;title&#34;],
                    from_plutus_schema(validator[&#34;redeemer&#34;][&#34;schema&#34;]),
                )
                parameter_types = [
                    (p[&#34;title&#34;], from_plutus_schema(p[&#34;schema&#34;]))
                    for p in validator[&#34;parameters&#34;]
                ]
                if &#34;oneOf&#34; in validator[&#34;redeemer&#34;][&#34;purpose&#34;]:
                    purpose = [
                        k
                        for k, v in PURPOSE_MAP.items()
                        if v in validator[&#34;redeemer&#34;][&#34;purpose&#34;][&#34;oneOf&#34;]
                    ]
                else:
                    purpose = [
                        k
                        for k, v in PURPOSE_MAP.items()
                        if v == validator[&#34;redeemer&#34;][&#34;purpose&#34;]
                    ]
                version = contract[&#34;preamble&#34;].get(&#34;version&#34;)
                title = contract[&#34;preamble&#34;].get(&#34;title&#34;)
                description = contract[&#34;preamble&#34;].get(&#34;description&#34;)
                license = contract[&#34;preamble&#34;].get(&#34;license&#34;)
                assert (
                    contract[&#34;preamble&#34;].get(&#34;plutusVersion&#34;) == &#34;v2&#34;
                ), &#34;Only Plutus V2 supported&#34;
                return PlutusContract(
                    contract_cbor,
                    datum_type,
                    redeemer_type,
                    parameter_types,
                    purpose,
                    version,
                    title,
                    description,
                    license,
                )
        except (ValueError, KeyError) as e:
            pass
    contract_cbor = None
    for contract_file in contract_candidates:
        with contract_file.open(&#34;r&#34;) as f:
            contract_content = f.read()
        # could be a singly wrapped cbor hex
        try:
            # try to unwrap to see if it is cbor
            contract_cbor_unwrapped = cbor2.loads(bytes.fromhex(contract_content))
            contract_cbor = bytes.fromhex(contract_content)
            # if we can unwrap again, its doubly wrapped
            try:
                cbor2.loads(contract_cbor_unwrapped)
                contract_cbor = contract_cbor_unwrapped
            except ValueError:
                pass
            break
        except ValueError:
            pass
        # could be a plutus json
        try:
            contract = json.loads(contract_content)
            contract_cbor = cbor2.loads(bytes.fromhex(contract[&#34;cborHex&#34;]))
        except (ValueError, KeyError):
            pass
        # could be uplc
        try:
            contract_ast = uplc.parse(contract_content)
            contract_cbor = uplc.flatten(contract_ast)
        except:
            pass
    if contract_cbor is None:
        raise ValueError(f&#34;Could not load contract from file {contract_path}&#34;)
    return PlutusContract(PlutusV2Script(contract_cbor))</code></pre>
</details>
</dd>
<dt id="opshin.builder.to_plutus_schema"><code class="name flex">
<span>def <span class="ident">to_plutus_schema</span></span>(<span>cls: Type[Union[pycardano.plutus.PlutusData, dict, int, bytes, pycardano.serialization.IndefiniteList, pycardano.serialization.RawCBOR, pycardano.plutus.RawPlutusData]]) ‑> dict</span>
</code></dt>
<dd>
<div class="desc"><p>Convert to a dictionary representing a json schema according to CIP 57 Plutus Blueprint
Reference of the core structure:
<a href="https://cips.cardano.org/cips/cip57/#corevocabulary">https://cips.cardano.org/cips/cip57/#corevocabulary</a></p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>**kwargs</code></strong></dt>
<dd>Extra key word arguments to be passed to <code>json.dumps()</code></dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>dict</code></dt>
<dd>a dict representing the schema of this class.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def to_plutus_schema(cls: typing.Type[Datum]) -&gt; dict:
    &#34;&#34;&#34;
    Convert to a dictionary representing a json schema according to CIP 57 Plutus Blueprint
    Reference of the core structure:
    https://cips.cardano.org/cips/cip57/#corevocabulary

    Args:
        **kwargs: Extra key word arguments to be passed to `json.dumps()`

    Returns:
        dict: a dict representing the schema of this class.
    &#34;&#34;&#34;
    if hasattr(cls, &#34;__origin__&#34;) and cls.__origin__ is list:
        return {
            &#34;dataType&#34;: &#34;list&#34;,
            **(
                {&#34;items&#34;: to_plutus_schema(cls.__args__[0])}
                if hasattr(cls, &#34;__args__&#34;)
                else {}
            ),
        }
    elif hasattr(cls, &#34;__origin__&#34;) and cls.__origin__ is dict:
        return {
            &#34;dataType&#34;: &#34;map&#34;,
            **(
                {
                    &#34;keys&#34;: to_plutus_schema(cls.__args__[0]),
                    &#34;values&#34;: to_plutus_schema(cls.__args__[1]),
                }
                if hasattr(cls, &#34;__args__&#34;)
                else {}
            ),
        }
    elif hasattr(cls, &#34;__origin__&#34;) and cls.__origin__ is Union:
        return {
            &#34;anyOf&#34;: (
                [to_plutus_schema(t) for t in cls.__args__]
                if hasattr(cls, &#34;__args__&#34;)
                else []
            )
        }
    elif issubclass(cls, PlutusData):
        fields = []
        for field_value in cls.__dataclass_fields__.values():
            if field_value.name == &#34;CONSTR_ID&#34;:
                continue
            field_schema = to_plutus_schema(field_value.type)
            field_schema[&#34;title&#34;] = field_value.name
            fields.append(field_schema)
        return {
            &#34;dataType&#34;: &#34;constructor&#34;,
            &#34;index&#34;: cls.CONSTR_ID,
            &#34;fields&#34;: fields,
            &#34;title&#34;: cls.__name__,
        }
    elif issubclass(cls, bytes):
        return {&#34;dataType&#34;: &#34;bytes&#34;}
    elif issubclass(cls, int):
        return {&#34;dataType&#34;: &#34;integer&#34;}
    elif issubclass(cls, IndefiniteList) or issubclass(cls, list):
        return {&#34;dataType&#34;: &#34;list&#34;}
    else:
        return {}</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="opshin.builder.PlutusContract"><code class="flex name class">
<span>class <span class="ident">PlutusContract</span></span>
<span>(</span><span>contract: pycardano.plutus.PlutusV2Script, datum_type: Optional[Tuple[str, Type[Union[pycardano.plutus.PlutusData, dict, int, bytes, pycardano.serialization.IndefiniteList, pycardano.serialization.RawCBOR, pycardano.plutus.RawPlutusData]]]] = None, redeemer_type: Optional[Tuple[str, Type[Union[pycardano.plutus.PlutusData, dict, int, bytes, pycardano.serialization.IndefiniteList, pycardano.serialization.RawCBOR, pycardano.plutus.RawPlutusData]]]] = None, parameter_types: List[Tuple[str, Type[Union[pycardano.plutus.PlutusData, dict, int, bytes, pycardano.serialization.IndefiniteList, pycardano.serialization.RawCBOR, pycardano.plutus.RawPlutusData]]]] = &lt;factory&gt;, purpose: Iterable[<a title="opshin.builder.Purpose" href="#opshin.builder.Purpose">Purpose</a>] = (&lt;Purpose.any: &#x27;any&#x27;&gt;,), version: Optional[str] = '1.0.0', title: str = 'validator', description: Optional[str] = 'opshin 0.19.1 Smart Contract', license: Optional[str] = None)</span>
</code></dt>
<dd>
<div class="desc"><p>PlutusContract(contract: pycardano.plutus.PlutusV2Script, datum_type: Optional[Tuple[str, Type[Union[pycardano.plutus.PlutusData, dict, int, bytes, pycardano.serialization.IndefiniteList, pycardano.serialization.RawCBOR, pycardano.plutus.RawPlutusData]]]] = None, redeemer_type: Optional[Tuple[str, Type[Union[pycardano.plutus.PlutusData, dict, int, bytes, pycardano.serialization.IndefiniteList, pycardano.serialization.RawCBOR, pycardano.plutus.RawPlutusData]]]] = None, parameter_types: List[Tuple[str, Type[Union[pycardano.plutus.PlutusData, dict, int, bytes, pycardano.serialization.IndefiniteList, pycardano.serialization.RawCBOR, pycardano.plutus.RawPlutusData]]]] = <factory>, purpose: Iterable[opshin.builder.Purpose] = (<Purpose.any: 'any'>,), version: Optional[str] = '1.0.0', title: str = 'validator', description: Optional[str] = 'opshin 0.19.1 Smart Contract', license: Optional[str] = None)</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@dataclasses.dataclass
class PlutusContract:
    contract: PlutusV2Script
    datum_type: Optional[typing.Tuple[str, typing.Type[Datum]]] = None
    redeemer_type: Optional[typing.Tuple[str, typing.Type[Datum]]] = None
    parameter_types: typing.List[typing.Tuple[str, typing.Type[Datum]]] = (
        dataclasses.field(default_factory=list)
    )
    purpose: typing.Iterable[Purpose] = (Purpose.any,)
    version: Optional[str] = &#34;1.0.0&#34;
    title: str = &#34;validator&#34;
    description: Optional[str] = f&#34;opshin {__version__} Smart Contract&#34;
    license: Optional[str] = None

    @property
    def cbor(self) -&gt; bytes:
        return self.contract

    @property
    def cbor_hex(self) -&gt; str:
        return self.contract.hex()

    @property
    def script_hash(self):
        return pycardano.plutus_script_hash(self.contract)

    @property
    def policy_id(self):
        return self.script_hash.to_primitive().hex()

    @property
    def mainnet_addr(self):
        return pycardano.Address(self.script_hash, network=pycardano.Network.MAINNET)

    @property
    def testnet_addr(self):
        return pycardano.Address(self.script_hash, network=pycardano.Network.TESTNET)

    @property
    def plutus_json(self):
        return json.dumps(
            {
                &#34;type&#34;: &#34;PlutusScriptV2&#34;,
                &#34;description&#34;: self.description,
                &#34;cborHex&#34;: self.cbor_hex,
            },
            indent=2,
        )

    @property
    def blueprint(self):
        return {
            &#34;$schema&#34;: &#34;https://cips.cardano.org/cips/cip57/schemas/plutus-blueprint.json&#34;,
            &#34;$id&#34;: &#34;https://github.com/aiken-lang/aiken/blob/main/examples/hello_world/plutus.json&#34;,
            &#34;$vocabulary&#34;: {
                &#34;https://json-schema.org/draft/2020-12/vocab/core&#34;: True,
                &#34;https://json-schema.org/draft/2020-12/vocab/applicator&#34;: True,
                &#34;https://json-schema.org/draft/2020-12/vocab/validation&#34;: True,
                &#34;https://cips.cardano.org/cips/cip57&#34;: True,
            },
            &#34;preamble&#34;: {
                &#34;version&#34;: self.version,
                &#34;plutusVersion&#34;: &#34;v2&#34;,
                &#34;description&#34;: self.description,
                &#34;title&#34;: self.title,
                **({&#34;license&#34;: self.license} if self.license is not None else {}),
            },
            &#34;validators&#34;: [
                {
                    &#34;title&#34;: self.title,
                    **(
                        {
                            &#34;datum&#34;: {
                                &#34;title&#34;: self.datum_type[0],
                                &#34;purpose&#34;: PURPOSE_MAP[Purpose.spending],
                                &#34;schema&#34;: to_plutus_schema(self.datum_type[1]),
                            }
                        }
                        if self.datum_type is not None
                        else {}
                    ),
                    &#34;redeemer&#34;: (
                        {
                            &#34;title&#34;: self.redeemer_type[0],
                            &#34;purpose&#34;: {
                                &#34;oneOf&#34;: [PURPOSE_MAP[p] for p in self.purpose]
                            },
                            &#34;schema&#34;: to_plutus_schema(self.redeemer_type[1]),
                        }
                        if self.redeemer_type is not None
                        else {}
                    ),
                    **(
                        {
                            &#34;parameters&#34;: [
                                {
                                    &#34;title&#34;: t[0],
                                    &#34;purpose&#34;: PURPOSE_MAP[Purpose.spending],
                                    &#34;schema&#34;: to_plutus_schema(t[1]),
                                }
                                for t in self.parameter_types
                            ]
                        }
                        if self.parameter_types
                        else {}
                    ),
                    &#34;compiledCode&#34;: self.cbor_hex,
                    &#34;hash&#34;: self.policy_id,
                },
            ],
        }

    def apply_parameter(self, *args: pycardano.Datum):
        &#34;&#34;&#34;
        Returns a new OpShin Contract with the applied parameters
        &#34;&#34;&#34;
        # update the parameters in the blueprint (remove applied parameters)
        assert len(self.parameter_types) &gt;= len(
            args
        ), f&#34;Applying too many parameters to contract, allowed amount: {self.parameter_types}, but got {len(args)}&#34;
        new_parameter_types = copy.copy(self.parameter_types)
        for _ in args:
            # TODO validate that the applied parameters are of the correct type
            new_parameter_types.pop(0)
        new_contract_contract = apply_parameters(self.contract, *args)
        new_contract = PlutusContract(
            new_contract_contract,
            self.datum_type,
            self.redeemer_type,
            new_parameter_types,
            self.purpose,
            self.version,
            self.title,
            self.description,
        )
        return new_contract

    def dump(self, target_dir: Union[str, Path]):
        target_dir = Path(target_dir)
        target_dir.mkdir(exist_ok=True, parents=True)
        with (target_dir / &#34;script.cbor&#34;).open(&#34;w&#34;) as fp:
            fp.write(self.cbor_hex)
        with (target_dir / &#34;script.plutus&#34;).open(&#34;w&#34;) as fp:
            fp.write(self.plutus_json)
        with (target_dir / &#34;script.policy_id&#34;).open(&#34;w&#34;) as fp:
            fp.write(self.policy_id)
        with (target_dir / &#34;mainnet.addr&#34;).open(&#34;w&#34;) as fp:
            fp.write(self.mainnet_addr.encode())
        with (target_dir / &#34;testnet.addr&#34;).open(&#34;w&#34;) as fp:
            fp.write(self.testnet_addr.encode())
        with (target_dir / &#34;blueprint.json&#34;).open(&#34;w&#34;) as fp:
            json.dump(self.blueprint, fp, indent=2)</code></pre>
</details>
<h3>Class variables</h3>
<dl>
<dt id="opshin.builder.PlutusContract.contract"><code class="name">var <span class="ident">contract</span> : pycardano.plutus.PlutusV2Script</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="opshin.builder.PlutusContract.datum_type"><code class="name">var <span class="ident">datum_type</span> : Optional[Tuple[str, Type[Union[pycardano.plutus.PlutusData, dict, int, bytes, pycardano.serialization.IndefiniteList, pycardano.serialization.RawCBOR, pycardano.plutus.RawPlutusData]]]]</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="opshin.builder.PlutusContract.description"><code class="name">var <span class="ident">description</span> : Optional[str]</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="opshin.builder.PlutusContract.license"><code class="name">var <span class="ident">license</span> : Optional[str]</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="opshin.builder.PlutusContract.parameter_types"><code class="name">var <span class="ident">parameter_types</span> : List[Tuple[str, Type[Union[pycardano.plutus.PlutusData, dict, int, bytes, pycardano.serialization.IndefiniteList, pycardano.serialization.RawCBOR, pycardano.plutus.RawPlutusData]]]]</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="opshin.builder.PlutusContract.purpose"><code class="name">var <span class="ident">purpose</span> : Iterable[<a title="opshin.builder.Purpose" href="#opshin.builder.Purpose">Purpose</a>]</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="opshin.builder.PlutusContract.redeemer_type"><code class="name">var <span class="ident">redeemer_type</span> : Optional[Tuple[str, Type[Union[pycardano.plutus.PlutusData, dict, int, bytes, pycardano.serialization.IndefiniteList, pycardano.serialization.RawCBOR, pycardano.plutus.RawPlutusData]]]]</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="opshin.builder.PlutusContract.title"><code class="name">var <span class="ident">title</span> : str</code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="opshin.builder.PlutusContract.version"><code class="name">var <span class="ident">version</span> : Optional[str]</code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
<h3>Instance variables</h3>
<dl>
<dt id="opshin.builder.PlutusContract.blueprint"><code class="name">var <span class="ident">blueprint</span></code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def blueprint(self):
    return {
        &#34;$schema&#34;: &#34;https://cips.cardano.org/cips/cip57/schemas/plutus-blueprint.json&#34;,
        &#34;$id&#34;: &#34;https://github.com/aiken-lang/aiken/blob/main/examples/hello_world/plutus.json&#34;,
        &#34;$vocabulary&#34;: {
            &#34;https://json-schema.org/draft/2020-12/vocab/core&#34;: True,
            &#34;https://json-schema.org/draft/2020-12/vocab/applicator&#34;: True,
            &#34;https://json-schema.org/draft/2020-12/vocab/validation&#34;: True,
            &#34;https://cips.cardano.org/cips/cip57&#34;: True,
        },
        &#34;preamble&#34;: {
            &#34;version&#34;: self.version,
            &#34;plutusVersion&#34;: &#34;v2&#34;,
            &#34;description&#34;: self.description,
            &#34;title&#34;: self.title,
            **({&#34;license&#34;: self.license} if self.license is not None else {}),
        },
        &#34;validators&#34;: [
            {
                &#34;title&#34;: self.title,
                **(
                    {
                        &#34;datum&#34;: {
                            &#34;title&#34;: self.datum_type[0],
                            &#34;purpose&#34;: PURPOSE_MAP[Purpose.spending],
                            &#34;schema&#34;: to_plutus_schema(self.datum_type[1]),
                        }
                    }
                    if self.datum_type is not None
                    else {}
                ),
                &#34;redeemer&#34;: (
                    {
                        &#34;title&#34;: self.redeemer_type[0],
                        &#34;purpose&#34;: {
                            &#34;oneOf&#34;: [PURPOSE_MAP[p] for p in self.purpose]
                        },
                        &#34;schema&#34;: to_plutus_schema(self.redeemer_type[1]),
                    }
                    if self.redeemer_type is not None
                    else {}
                ),
                **(
                    {
                        &#34;parameters&#34;: [
                            {
                                &#34;title&#34;: t[0],
                                &#34;purpose&#34;: PURPOSE_MAP[Purpose.spending],
                                &#34;schema&#34;: to_plutus_schema(t[1]),
                            }
                            for t in self.parameter_types
                        ]
                    }
                    if self.parameter_types
                    else {}
                ),
                &#34;compiledCode&#34;: self.cbor_hex,
                &#34;hash&#34;: self.policy_id,
            },
        ],
    }</code></pre>
</details>
</dd>
<dt id="opshin.builder.PlutusContract.cbor"><code class="name">var <span class="ident">cbor</span> : bytes</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def cbor(self) -&gt; bytes:
    return self.contract</code></pre>
</details>
</dd>
<dt id="opshin.builder.PlutusContract.cbor_hex"><code class="name">var <span class="ident">cbor_hex</span> : str</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def cbor_hex(self) -&gt; str:
    return self.contract.hex()</code></pre>
</details>
</dd>
<dt id="opshin.builder.PlutusContract.mainnet_addr"><code class="name">var <span class="ident">mainnet_addr</span></code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def mainnet_addr(self):
    return pycardano.Address(self.script_hash, network=pycardano.Network.MAINNET)</code></pre>
</details>
</dd>
<dt id="opshin.builder.PlutusContract.plutus_json"><code class="name">var <span class="ident">plutus_json</span></code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def plutus_json(self):
    return json.dumps(
        {
            &#34;type&#34;: &#34;PlutusScriptV2&#34;,
            &#34;description&#34;: self.description,
            &#34;cborHex&#34;: self.cbor_hex,
        },
        indent=2,
    )</code></pre>
</details>
</dd>
<dt id="opshin.builder.PlutusContract.policy_id"><code class="name">var <span class="ident">policy_id</span></code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def policy_id(self):
    return self.script_hash.to_primitive().hex()</code></pre>
</details>
</dd>
<dt id="opshin.builder.PlutusContract.script_hash"><code class="name">var <span class="ident">script_hash</span></code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def script_hash(self):
    return pycardano.plutus_script_hash(self.contract)</code></pre>
</details>
</dd>
<dt id="opshin.builder.PlutusContract.testnet_addr"><code class="name">var <span class="ident">testnet_addr</span></code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">@property
def testnet_addr(self):
    return pycardano.Address(self.script_hash, network=pycardano.Network.TESTNET)</code></pre>
</details>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="opshin.builder.PlutusContract.apply_parameter"><code class="name flex">
<span>def <span class="ident">apply_parameter</span></span>(<span>self, *args: Union[pycardano.plutus.PlutusData, dict, int, bytes, pycardano.serialization.IndefiniteList, pycardano.serialization.RawCBOR, pycardano.plutus.RawPlutusData])</span>
</code></dt>
<dd>
<div class="desc"><p>Returns a new OpShin Contract with the applied parameters</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def apply_parameter(self, *args: pycardano.Datum):
    &#34;&#34;&#34;
    Returns a new OpShin Contract with the applied parameters
    &#34;&#34;&#34;
    # update the parameters in the blueprint (remove applied parameters)
    assert len(self.parameter_types) &gt;= len(
        args
    ), f&#34;Applying too many parameters to contract, allowed amount: {self.parameter_types}, but got {len(args)}&#34;
    new_parameter_types = copy.copy(self.parameter_types)
    for _ in args:
        # TODO validate that the applied parameters are of the correct type
        new_parameter_types.pop(0)
    new_contract_contract = apply_parameters(self.contract, *args)
    new_contract = PlutusContract(
        new_contract_contract,
        self.datum_type,
        self.redeemer_type,
        new_parameter_types,
        self.purpose,
        self.version,
        self.title,
        self.description,
    )
    return new_contract</code></pre>
</details>
</dd>
<dt id="opshin.builder.PlutusContract.dump"><code class="name flex">
<span>def <span class="ident">dump</span></span>(<span>self, target_dir: Union[pathlib.Path, str])</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def dump(self, target_dir: Union[str, Path]):
    target_dir = Path(target_dir)
    target_dir.mkdir(exist_ok=True, parents=True)
    with (target_dir / &#34;script.cbor&#34;).open(&#34;w&#34;) as fp:
        fp.write(self.cbor_hex)
    with (target_dir / &#34;script.plutus&#34;).open(&#34;w&#34;) as fp:
        fp.write(self.plutus_json)
    with (target_dir / &#34;script.policy_id&#34;).open(&#34;w&#34;) as fp:
        fp.write(self.policy_id)
    with (target_dir / &#34;mainnet.addr&#34;).open(&#34;w&#34;) as fp:
        fp.write(self.mainnet_addr.encode())
    with (target_dir / &#34;testnet.addr&#34;).open(&#34;w&#34;) as fp:
        fp.write(self.testnet_addr.encode())
    with (target_dir / &#34;blueprint.json&#34;).open(&#34;w&#34;) as fp:
        json.dump(self.blueprint, fp, indent=2)</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="opshin.builder.Purpose"><code class="flex name class">
<span>class <span class="ident">Purpose</span></span>
<span>(</span><span>value, names=None, *, module=None, qualname=None, type=None, start=1)</span>
</code></dt>
<dd>
<div class="desc"><p>An enumeration.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">class Purpose(enum.Enum):
    spending = &#34;spending&#34;
    minting = &#34;minting&#34;
    rewarding = &#34;rewarding&#34;
    certifying = &#34;certifying&#34;
    any = &#34;any&#34;
    lib = &#34;lib&#34;</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>enum.Enum</li>
</ul>
<h3>Class variables</h3>
<dl>
<dt id="opshin.builder.Purpose.any"><code class="name">var <span class="ident">any</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="opshin.builder.Purpose.certifying"><code class="name">var <span class="ident">certifying</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="opshin.builder.Purpose.lib"><code class="name">var <span class="ident">lib</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="opshin.builder.Purpose.minting"><code class="name">var <span class="ident">minting</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="opshin.builder.Purpose.rewarding"><code class="name">var <span class="ident">rewarding</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
<dt id="opshin.builder.Purpose.spending"><code class="name">var <span class="ident">spending</span></code></dt>
<dd>
<div class="desc"></div>
</dd>
</dl>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<div style="max-width: 330px; margin-bottom: 10px">
<header>
<a class="homelink" rel="home" title="opshin Home" href="https://opshin.opshin.dev/">
<img src="https://raw.githubusercontent.com/OpShin/opshin/master/opshin.png" alt="opshin logo"> &nbsp; opshin
</a>
</header>
</div>
<form>
<input id="lunr-search" name="q" placeholder="🔎 Search ..." aria-label="Search"
disabled minlength="2">
</form>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.css" integrity="sha512-j1u8eUJ4f23xPPxwOrLUPQaCD2dwzNqqmDDcWS4deWsMv2ohLqmXXuP3hU7g8TyzbMSakP/mMqoNBYWj8AEIFg==" crossorigin>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.js" integrity="sha512-plGUER9JkeEWPPqQBE4sdLqBoQug5Ap+BCGMc7bJ8BXkm+VVj6QzkpBz5Yv2yPkkq+cqg9IpkBaGCas6uDbW8g==" crossorigin></script>
<style>
.modal-dialog iframe {
width: 100vw;
height: calc(100vh - 80px);
}
@media screen and (min-width: 700px) {
.modal-dialog iframe {
width: 70vw;
height: 80vh;
}
}
.modal-dialog .tingle-modal-box {width: auto;}
.modal-dialog .tingle-modal-box__content {padding: 0;}
</style>
<script>
const input = document.getElementById('lunr-search');
input.disabled = false;
input.form.addEventListener('submit', (ev) => {
ev.preventDefault();
const url = new URL(window.location);
url.searchParams.set('q', input.value);
history.replaceState({}, null, url.toString());
search(input.value);
});
const query = new URL(window.location).searchParams.get('q');
if (query)
search(query);
function search(query) {
const url = '../doc-search.html#' + encodeURIComponent(query);
new tingle.modal({
cssClass: ['modal-dialog'],
onClose: () => {
const url = new URL(window.location);
url.searchParams.delete('q');
history.replaceState({}, null, url.toString());
setTimeout(() => input.focus(), 100);
}
}).setContent('<iframe src="' + url + '"></iframe>').open();
}
</script>
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="opshin" href="index.html">opshin</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="two-column">
<li><code><a title="opshin.builder.apply_parameters" href="#opshin.builder.apply_parameters">apply_parameters</a></code></li>
<li><code><a title="opshin.builder.build" href="#opshin.builder.build">build</a></code></li>
<li><code><a title="opshin.builder.compile" href="#opshin.builder.compile">compile</a></code></li>
<li><code><a title="opshin.builder.from_plutus_schema" href="#opshin.builder.from_plutus_schema">from_plutus_schema</a></code></li>
<li><code><a title="opshin.builder.load" href="#opshin.builder.load">load</a></code></li>
<li><code><a title="opshin.builder.to_plutus_schema" href="#opshin.builder.to_plutus_schema">to_plutus_schema</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="opshin.builder.PlutusContract" href="#opshin.builder.PlutusContract">PlutusContract</a></code></h4>
<ul class="two-column">
<li><code><a title="opshin.builder.PlutusContract.apply_parameter" href="#opshin.builder.PlutusContract.apply_parameter">apply_parameter</a></code></li>
<li><code><a title="opshin.builder.PlutusContract.blueprint" href="#opshin.builder.PlutusContract.blueprint">blueprint</a></code></li>
<li><code><a title="opshin.builder.PlutusContract.cbor" href="#opshin.builder.PlutusContract.cbor">cbor</a></code></li>
<li><code><a title="opshin.builder.PlutusContract.cbor_hex" href="#opshin.builder.PlutusContract.cbor_hex">cbor_hex</a></code></li>
<li><code><a title="opshin.builder.PlutusContract.contract" href="#opshin.builder.PlutusContract.contract">contract</a></code></li>
<li><code><a title="opshin.builder.PlutusContract.datum_type" href="#opshin.builder.PlutusContract.datum_type">datum_type</a></code></li>
<li><code><a title="opshin.builder.PlutusContract.description" href="#opshin.builder.PlutusContract.description">description</a></code></li>
<li><code><a title="opshin.builder.PlutusContract.dump" href="#opshin.builder.PlutusContract.dump">dump</a></code></li>
<li><code><a title="opshin.builder.PlutusContract.license" href="#opshin.builder.PlutusContract.license">license</a></code></li>
<li><code><a title="opshin.builder.PlutusContract.mainnet_addr" href="#opshin.builder.PlutusContract.mainnet_addr">mainnet_addr</a></code></li>
<li><code><a title="opshin.builder.PlutusContract.parameter_types" href="#opshin.builder.PlutusContract.parameter_types">parameter_types</a></code></li>
<li><code><a title="opshin.builder.PlutusContract.plutus_json" href="#opshin.builder.PlutusContract.plutus_json">plutus_json</a></code></li>
<li><code><a title="opshin.builder.PlutusContract.policy_id" href="#opshin.builder.PlutusContract.policy_id">policy_id</a></code></li>
<li><code><a title="opshin.builder.PlutusContract.purpose" href="#opshin.builder.PlutusContract.purpose">purpose</a></code></li>
<li><code><a title="opshin.builder.PlutusContract.redeemer_type" href="#opshin.builder.PlutusContract.redeemer_type">redeemer_type</a></code></li>
<li><code><a title="opshin.builder.PlutusContract.script_hash" href="#opshin.builder.PlutusContract.script_hash">script_hash</a></code></li>
<li><code><a title="opshin.builder.PlutusContract.testnet_addr" href="#opshin.builder.PlutusContract.testnet_addr">testnet_addr</a></code></li>
<li><code><a title="opshin.builder.PlutusContract.title" href="#opshin.builder.PlutusContract.title">title</a></code></li>
<li><code><a title="opshin.builder.PlutusContract.version" href="#opshin.builder.PlutusContract.version">version</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="opshin.builder.Purpose" href="#opshin.builder.Purpose">Purpose</a></code></h4>
<ul class="two-column">
<li><code><a title="opshin.builder.Purpose.any" href="#opshin.builder.Purpose.any">any</a></code></li>
<li><code><a title="opshin.builder.Purpose.certifying" href="#opshin.builder.Purpose.certifying">certifying</a></code></li>
<li><code><a title="opshin.builder.Purpose.lib" href="#opshin.builder.Purpose.lib">lib</a></code></li>
<li><code><a title="opshin.builder.Purpose.minting" href="#opshin.builder.Purpose.minting">minting</a></code></li>
<li><code><a title="opshin.builder.Purpose.rewarding" href="#opshin.builder.Purpose.rewarding">rewarding</a></code></li>
<li><code><a title="opshin.builder.Purpose.spending" href="#opshin.builder.Purpose.spending">spending</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>